{{define "commit.html"}}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Commit {{shortID .Commit.ID}} - Tin</title>
    {{template "styles"}}
</head>
<body>
    <div class="header">
        <h1><a href="/">Tin</a></h1>
        <nav class="nav">
            <a href="/">Repositories</a> /
            <a href="/repo/{{.RepoPath}}">{{.RepoName}}</a> /
            <span class="commit-hash">{{shortID .Commit.ID}}</span>
        </nav>
    </div>

    <h2>Commit <code>{{shortID .Commit.ID}}</code></h2>

    <dl class="metadata">
        <dt>Message</dt>
        <dd>{{.Commit.Message}}</dd>
        <dt>Date</dt>
        <dd>{{formatTime .Commit.Timestamp}}</dd>
        <dt>Git Commit</dt>
        <dd>
            {{$url := commitURL .CodeHostURL .Commit.GitCommitHash}}
            {{if $url}}<a href="{{$url}}" target="_blank"><code>{{.Commit.GitCommitHash}}</code></a>{{else}}<code>{{.Commit.GitCommitHash}}</code>{{end}}
        </dd>
        {{if .Commit.Author}}
        <dt>Author</dt>
        <dd>{{.Commit.Author}}</dd>
        {{end}}
        <dt>Threads</dt>
        <dd>{{len .Commit.Threads}} thread(s)</dd>
    </dl>

    {{range .Threads}}
    <div class="thread">
        <div class="thread-header">
            <h3>
                <a href="/repo/{{$.RepoPath}}/thread/{{.Thread.ID}}{{if .ContentHash}}?version={{.ContentHash}}{{end}}">Thread <code>{{shortID .Thread.ID}}</code></a>
                {{if .ParentThread}}
                <span class="continuation-note">(continued from <a href="/repo/{{$.RepoPath}}/thread/{{.ParentThread.ID}}"><code>{{shortID .ParentThread.ID}}</code></a>)</span>
                {{end}}
                {{if .ChildThreads}}
                <span class="continuation-note">(continued in {{range $i, $child := .ChildThreads}}{{if $i}}, {{end}}<a href="/repo/{{$.RepoPath}}/thread/{{$child.ID}}"><code>{{shortID $child.ID}}</code></a>{{end}})</span>
                {{end}}
            </h3>
            <p>
                <strong>Agent:</strong> {{.Thread.Agent}} |
                <strong>Started:</strong> {{formatTime .Thread.StartedAt}} |
                <strong>Messages:</strong> {{len .Thread.Messages}}{{if and .IsVersioned (gt .LatestCount (len .Thread.Messages))}} <span class="version-note">(of {{.LatestCount}} in latest version)</span>{{end}}
            </p>
        </div>

        {{if .Thread.Messages}}
        {{with index .Thread.Messages 0}}
        <div class="message {{roleClass .Role}}">
            <div class="message-header">
                <span class="message-role">{{if eq .Role "human"}}Human{{else}}Assistant{{end}}</span>
                <span>{{formatTime .Timestamp}}</span>
            </div>
            <div class="message-content">{{.Content}}</div>
        </div>
        {{end}}
        {{end}}
        <div class="view-more">
            <a href="/repo/{{$.RepoPath}}/thread/{{.Thread.ID}}{{if .ContentHash}}?version={{.ContentHash}}{{end}}">View full thread ({{len .Thread.Messages}} messages)</a>
        </div>
    </div>
    {{end}}

    {{if not .Threads}}
    <p class="empty-state">No threads found for this commit.</p>
    {{end}}
</body>
</html>
{{end}}
