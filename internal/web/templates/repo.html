{{define "repo.html"}}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.RepoName}} - Tin</title>
    {{template "styles"}}
</head>
<body>
    <div class="header">
        <h1><a href="/">Tin</a></h1>
        <nav class="nav">
            <a href="/">Repositories</a> / {{.RepoName}}
        </nav>
    </div>

    <h2>{{.RepoName}}</h2>

    <h3>Branches</h3>
    <ul class="branch-list">
    {{range .Branches}}
        <li {{if .IsCurrent}}class="branch-current"{{end}}>
            <a href="/repo/{{$.RepoPath}}?branch={{.Name}}">{{.Name}}</a>
            {{if .CommitID}}<span class="commit-hash">({{shortID .CommitID}})</span>{{end}}
        </li>
    {{end}}
    </ul>

    <h3>Commits on {{.SelectedBranch}}</h3>
    {{if .Commits}}
    <table>
        <thead>
            <tr>
                <th></th>
                <th>ID</th>
                <th>Message</th>
                <th>Date</th>
                <th>Git</th>
            </tr>
        </thead>
        <tbody>
        {{range .Commits}}
            <tr>
                <td class="agent-icons-cell">
                    {{if eq (len .Agents) 1}}
                        {{$iconPath := agentIconPath (index .Agents 0)}}
                        {{if $iconPath}}<img src="{{$iconPath}}" alt="{{index .Agents 0}}" title="{{index .Agents 0}}" class="agent-icon {{agentIconClass (index .Agents 0)}}">{{end}}
                    {{else if gt (len .Agents) 1}}
                        <span class="agent-icons-stacked">
                            {{range $i, $agent := .Agents}}
                                {{$iconPath := agentIconPath $agent}}
                                {{if $iconPath}}<img src="{{$iconPath}}" alt="{{$agent}}" title="{{$agent}}" class="agent-icon {{agentIconClass $agent}} stacked-{{$i}}">{{end}}
                            {{end}}
                        </span>
                    {{end}}
                </td>
                <td>
                    {{if isMergeCommit .TinCommit}}<span class="merge-indicator" title="Merge commit">â‘‚</span>{{end}}<a href="/repo/{{$.RepoPath}}/commit/{{.ID}}" class="commit-hash">{{shortID .ID}}</a>
                </td>
                <td>
                    <a href="/repo/{{$.RepoPath}}/commit/{{.ID}}" class="commit-message-link">{{truncate .Message 60}}</a>
                    {{if .Author}}<div class="commit-author">{{.Author}}</div>{{end}}
                </td>
                <td>{{formatTime .Timestamp}}</td>
                <td>
                    {{$url := commitURL $.CodeHostURL .GitCommitHash}}
                    {{if $url}}<a href="{{$url}}" target="_blank"><code>{{shortID .GitCommitHash}}</code></a>{{else}}<code>{{shortID .GitCommitHash}}</code>{{end}}
                </td>
            </tr>
        {{end}}
        </tbody>
    </table>
    {{else}}
    <p class="empty-state">No commits on this branch yet.</p>
    {{end}}
</body>
</html>
{{end}}
